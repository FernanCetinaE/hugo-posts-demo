{{- define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end -}}
{{ define "main" }}
  {{ $metaInfo := .Site.Params.articleMeta }}
  {{ $maxW := "w-[79%]" }}
  {{ if $metaInfo.disableToc }}
    {{ $maxW = "w-full" }}
  {{ end }}
  <div class="mx-auto my-5 max-w-7xl bg-slate-50 px-5">
    <div class="flex w-full justify-between">
      <div class="lg:{{ $maxW }} w-full">
        {{/* Title */}}
        <div class="px-3 py-10 text-center text-3xl font-bold text-black">{{ .Title }}</div>

        {{/* Article Meta Infoï¼šPublication time, word count, reading time */}}
        <div
          class="flex flex-row flex-wrap items-center justify-center space-x-4 px-3 pb-3 font-postmeta text-xs text-gray-700 md:text-sm"
        >
          {{/* Author */}}
          {{ if and ($metaInfo.enableAuthor) .Params.author }}
            <div class="flex flex-row items-center space-x-1">
              <svg
                class="icon"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill="#515151"
                  d="M501.937582 545.097053c147.891962 0 268.231366-118.534055 268.223274-264.288929 0-145.746783-120.330301-264.28994-268.222263-264.28994-147.890951 0-268.221252 118.584625-268.221252 264.28994C233.71633 426.520519 354.046631 545.097053 501.937582 545.097053zM612.471463 570.546911 411.497184 570.546911c-186.760063 0-338.664249 149.569875-338.664249 333.472733l0 19.794109c0 96.139636 149.47278 96.139636 338.664249 96.139636l200.974278 0c181.747565 0 338.694591 0 338.694591-96.139636l0-19.794109C951.164031 720.158252 799.235571 570.546911 612.471463 570.546911z"
                />
              </svg>
              <p>{{- .Params.author -}}</p>
            </div>
          {{ end }}
          {{/* Publish Date */}}
          {{ if not $metaInfo.disabledate }}
            <div class="flex flex-row items-center space-x-1">
              <svg
                class="icon"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill="#515151"
                  d="M773.2 178.1v91c0 49.5-40.3 89.8-89.8 89.8-24.1 0-46.7-9.4-63.7-26.5-16.8-17-26.1-39.4-26.1-63.2v-90.8-0.3H433.8v91.1c0 49.5-40.3 89.8-89.8 89.8-49.2 0-89.2-40.3-89.2-89.8v-90.8-0.2C163.6 180.2 90 255 90 346.7v379.9c0 93 75.6 168.6 168.6 168.6h510.7c93 0 168.6-75.6 168.6-168.6v-380c0-91.6-73.5-166.4-164.7-168.5zM408.7 739.4c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24 0-43.8-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m0-140.6c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24 0-43.8-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m0-141c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24 0-43.8-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m169.4 281.6c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24.6 0-43.8-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m0-140.6c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24.6 0-43.8-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m0-141c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24.6 0-43.8-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m169.4 281.6c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24.6 0-44.4-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m0-140.6c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24.6 0-44.4-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z m0-140.5c0 24.6-19.8 44.4-44.4 44.4h-39.5c-24.6 0-44.4-19.8-44.4-44.4v-10.7c0-24.6 19.8-44.4 44.4-44.4h39.5c24.6 0 44.4 19.8 44.4 44.4v10.7z"
                />
                <path
                  fill="#515151"
                  d="M344.1 316.2c25.6 0 47-20.8 47-47v-90.8c0.5-26.2-20.8-47-46.5-47s-47 20.8-47 47v90.8c0 25.6 20.8 47 46.5 47zM683.4 316.2c25.6 0 47-20.8 47-47v-90.8c-0.5-26.2-21.4-47-47-47s-47 20.8-47 47v90.8c0 25.6 20.8 47 47 47z"
                />
              </svg>
              <p>{{- .Date.Format "2006/01/02" -}}</p>
            </div>
          {{ end }}
          {{/* Word Count */}}
          {{ if not $metaInfo.disableCountWords }}
            <div class="flex flex-row items-center space-x-1">
              <svg
                class="icon"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill="#515151"
                  d="M760.744759 112.25055 267.815093 112.25055c-42.271756 0-76.659961 34.399461-76.659961 76.670194l0 91.080391 0 297.006438 0 232.745878c0 42.271756 34.388205 76.670194 76.659961 76.670194l401.851321 0c42.270732 0 76.658937-34.398438 76.658937-76.670194L746.325351 280.000112c0-42.271756-34.388205-76.671217-76.658937-76.671217L267.815093 203.328895c-11.085476 0-21.60404 2.424212-31.120788 6.670933l0-21.080108c0-17.165961 13.964036-31.131021 31.120788-31.131021l492.929666 0c17.156752 0 31.119765 13.96506 31.119765 31.131021l0 620.832707c0 12.586666 10.1952 22.77061 22.771633 22.77061 12.573363 0 22.76754-10.183943 22.76754-22.77061L837.403696 188.91972C837.403696 146.648988 803.018561 112.25055 760.744759 112.25055zM453.364043 397.762189l34.512025 0 83.119069 247.542886-39.646975 0-22.704095-72.100108-75.068719 0-21.225417 72.100108-37.279045 0L453.364043 397.762189zM479.225037 478.278991c-3.333932-10.773368-6.225795-20.557198-8.626471-29.262464-1.958608 8.516977-4.214998 16.98893-6.78145 25.360598l-19.790742 63.673182 53.589522 0L479.225037 478.278991z"
                />
              </svg>
              <p>{{- .WordCount | printf "%d words" -}}</p>
            </div>
          {{ end }}
          {{/* Read Time */}}
          {{ if not $metaInfo.disableReadTime }}
            <div class="flex flex-row items-center space-x-1">
              <svg
                class="icon"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill="#515151"
                  d="M502.784 75.264c-245.76 0-443.904 198.144-443.904 443.904S259.584 962.56 502.784 962.56c245.76 0 443.904-198.144 443.904-443.904s-200.192-443.392-443.904-443.392z m289.28 578.048c-6.656 13.824-18.432 20.48-31.744 20.48-4.608 0-9.216 0-13.824-2.048L484.864 552.96c-11.264-4.608-20.48-18.432-20.48-31.744v-245.76c0-18.432 15.872-34.304 34.304-34.304s34.304 15.872 34.304 34.304v225.28l241.152 109.056c17.92 6.656 24.576 25.088 17.92 43.52z"
                />
              </svg>
              <p>{{- .ReadingTime| printf "%d minutes" -}}</p>
            </div>
          {{ end }}
          {{/* Page view */}}
          {{ if and .Site.Params.waline.serverURL (or .Site.Params.waline.alonePageview  .Site.Params.waline.pageview) }}
            <div class="flex flex-row items-center space-x-1">
              <svg
                class="icon"
                width="16"
                height="16"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill="#515151"
                  d="M455.68 404.032l91.264 529.152s67.456-69.44 123.136-117.888L792.512 979.2c4.928 6.656 15.68 7.104 23.872 1.088l52.288-38.208c8.256-6.016 10.944-16.32 5.952-22.976L755.52 759.68c62.208-25.088 164.672-53.632 164.672-53.632L455.68 404.032zM308.352 648.384L172.48 747.712c-20.544 15.04-24.256 43.968-8 65.408 16.256 21.376 46.272 27.008 66.752 12.032l135.872-99.328c20.992-15.36 24.512-45.504 8.256-66.88-16.192-21.44-46.016-25.92-67.008-10.56z m641.344-409.408C933.44 217.6 904.064 212.8 882.624 228.48l-134.912 98.688c-21.44 15.68-25.152 44.672-8.896 66.048 16.256 21.376 46.272 27.008 67.712 11.328l134.912-98.688c21.44-15.68 24.512-45.504 8.256-66.88z m-630.4-102.144c-15.936-20.928-45.248-25.728-66.752-10.048-20.096 14.72-24.256 43.968-8.32 64.896L349.76 330.496c15.936 20.992 45.696 25.408 65.792 10.688 21.44-15.68 25.216-44.608 9.28-65.6L319.296 136.832zM585.792 301.76c26.176 4.224 50.24-13.376 53.632-39.232L660.608 94.72c3.392-25.792-14.976-49.984-41.536-54.656-26.176-4.224-50.24 13.376-53.632 39.168l-21.248 167.872c-3.264 25.856 15.104 49.984 41.6 54.656zM329.728 489.024c2.56-25.92-15.808-50.048-41.536-54.656L118.144 406.4c-27.072-3.584-50.688 13.696-53.632 39.232-3.904 26.944 14.464 51.072 41.536 54.656l170.048 27.968c25.728 4.48 49.408-12.8 53.632-39.232z"
                />
              </svg>
              <p><span class="waline-pageview-count" data-path="{{ .RelPermalink }}">...</span> views</p>
            </div>
          {{ end }}

          {{/* Comments count */}}
          {{ if and .Site.Params.waline.serverURL .Site.Params.waline.comment }}
            <div class="flex flex-row items-center space-x-1">
              <svg
                t="1689257719197"
                class="icon"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="21488"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                width="16"
                height="16"
              >
                <path
                  d="M860.16 430.08c0-223.744-192-402.944-431.616-402.944C191.488 27.136 0 209.408 0 430.08c0 73.728 22.528 143.872 57.344 201.216l-41.472 140.8c-9.728 35.328 9.728 51.2 41.472 41.472l134.144-44.544c67.072 41.472 146.944 64 233.472 64 243.2 3.072 435.2-179.2 435.2-402.944z m-214.528-54.272c28.672 0 54.272 25.6 54.272 54.272s-25.6 54.272-54.272 54.272-54.272-25.6-54.272-54.272 25.6-54.272 54.272-54.272zM214.016 484.352c-28.672 0-54.272-25.6-54.272-54.272s25.6-54.272 54.272-54.272 54.272 25.6 54.272 54.272-22.016 54.272-54.272 54.272zM377.344 430.08c0-28.672 25.6-54.272 54.272-54.272s54.272 25.6 54.272 54.272-25.6 54.272-54.272 54.272S377.344 461.824 377.344 430.08z m0 0"
                  p-id="21489"
                ></path>
                <path
                  d="M965.632 794.624c35.328-60.928 57.344-128 57.344-201.216 0-112.128-48.128-210.944-124.928-284.672 12.8 38.4 18.944 79.872 18.944 124.928v35.328c18.944 38.4 28.672 82.944 28.672 128 0 57.344-15.872 112.128-44.544 159.744l-18.944 28.672 9.728 35.328 15.872 54.272-51.2-15.872-35.328-12.8-31.744 18.944c-57.344 35.328-124.928 54.272-192 54.272-51.2 0-99.328-9.728-140.8-28.672h-18.944c-54.272 0-108.544-9.728-156.672-25.6 79.872 79.872 192 131.072 320 131.072 86.528 0 166.4-25.6 233.472-64l143.872 48.128c28.672 9.728 44.544-6.144 35.328-35.328l-48.128-150.528z m0 0"
                  p-id="21490"
                ></path>
              </svg>
              <p><span class="waline-comment-count" data-path="{{ .RelPermalink }}">...</span> comments</p>
            </div>
          {{ end }}

        </div>

        {{/* Image */}}
        {{ if not $metaInfo.disableHero }}
          {{ $image := resources.Get .Params.image }}
          {{ with $image }}
            <div id="post-feature" class="{{ if not $metaInfo.disableToc }}lg:-mr-0{{ end }} -mx-5">
              <img class="h-120 w-full object-cover" src="{{ $image.Permalink }}" alt="preview image" srcset="" />
            </div>
          {{ else }}
            <div id="post-feature" class="{{ if not $metaInfo.disableToc }}lg:-mr-0{{ end }} -mx-5 h-120">
              {{ partial "default_bg.html" . }}
            </div>
          {{ end }}
        {{ else }}
          <div id="post-feature" class="mx-1 mb-4 mt-0 border-b border-gray-400 md:mx-3 lg:mx-10"></div>
        {{ end }}

        {{/* Content */}}
        <div
          id="single-content"
          class="prose mx-auto max-w-none px-1 py-5 dark:prose-invert md:prose-base prose-figure:flex prose-figure:flex-col prose-figure:items-center prose-img:cursor-zoom-in md:px-3 lg:px-10"
        >
          {{ .Content }}
        </div>

        {{/* Updated Date */}}
        <div class="my-0.5 flex flex-row items-center space-x-1 px-1 py-0.5 md:px-3 lg:px-10">
          <svg
            t="1686815337104"
            class="icon"
            viewBox="0 0 1024 1024"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            p-id="60278"
            width="16px"
            height="16px"
          >
            <path
              d="M534.016 342.016l0 180.010667 148.010667 89.984-29.994667 52.010667-182.016-109.994667 0-212.010667 64 0zM896 432l-290.005333 0 118.016-120.021333q-88.021333-88.021333-210.986667-89.002667t-210.986667 84.992q-86.016 88.021333-86.016 208t86.016 208 210.005333 88.021333 212.010667-88.021333q86.016-86.016 86.016-208l86.016 0q0 157.994667-112 267.989333-112 112-272 112t-272-112q-112-109.994667-112-267.008t112-269.013333 269.994667-112 269.994667 112l116.010667-120.021333 0 304z"
              fill="#515151"
              p-id="60279"
            ></path>
          </svg>
          <span class="font-postmeta text-xs text-gray-500">Updated on {{ .Lastmod.Format "January 2 2006" }}</span>
        </div>

        {{/* horizontal rule */}}
        <hr class="mx-1 my-1 md:mx-3 lg:mx-10" />

        {{/* categories && tags */}}
        <div class="flex flex-col justify-start px-1 pb-5 pt-1 md:px-3 lg:flex-row lg:justify-between lg:px-10">
          {{ $tags := (.GetTerms "tags") }}
          {{ $tagsNums := len $tags }}
          {{ if ge $tagsNums 1 }}
            <div class="flex flex-row items-center">
              <svg
                class="icon"
                width="16px"
                height="16px"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill="#6B7280"
                  d="M690 78.2l255.6 258.6c104.8 106 104.8 276.4 0 382.4l-224 226.6c-18.6 18.8-49 19-67.8 0.4s-19-49-0.4-67.8l223.8-226.6c67.8-68.6 67.8-178.8 0-247.4L621.8 145.8c-18.6-18.8-18.4-49.2 0.4-67.8s49.2-18.4 67.8 0.4zM0 459V160c0-53 43-96 96-96h299c34 0 66.6 13.4 90.6 37.4l336 336c50 50 50 131 0 181L554.6 885.4c-50 50-131 50-181 0l-336-336C13.4 525.4 0 493 0 459zM288 288a64 64 0 1 0-128 0 64 64 0 1 0 128 0z"
                />
              </svg>
              {{ range $tags }}
                <a
                  class="mx-1 my-0.5 rounded-xl bg-gray-200 bg-opacity-30 px-1.5 py-0.5 text-center text-xs text-gray-900 hover:bg-opacity-80 hover:text-blue-700"
                  href="{{ .Permalink }}"
                  >{{ .LinkTitle }}</a
                >
              {{ end }}
            </div>
          {{ end }}

          {{ $categories := (.GetTerms "categories") }}
          {{ $cateNums := len $categories }}
          {{ if ge $cateNums 1 }}
            <div class="flex flex-row items-center">
              <svg
                class="icon"
                width="16px"
                height="16px"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill="#6B7280"
                  d="M170.666667 469.333333h256a42.666667 42.666667 0 0 0 42.666666-42.666666V170.666667a42.666667 42.666667 0 0 0-42.666666-42.666667H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v256a42.666667 42.666667 0 0 0 42.666667 42.666666z m426.666666 0h256a42.666667 42.666667 0 0 0 42.666667-42.666666V170.666667a42.666667 42.666667 0 0 0-42.666667-42.666667h-256a42.666667 42.666667 0 0 0-42.666666 42.666667v256a42.666667 42.666667 0 0 0 42.666666 42.666666zM170.666667 896h256a42.666667 42.666667 0 0 0 42.666666-42.666667v-256a42.666667 42.666667 0 0 0-42.666666-42.666666H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666666v256a42.666667 42.666667 0 0 0 42.666667 42.666667z m554.666666 0c94.122667 0 170.666667-76.544 170.666667-170.666667s-76.544-170.666667-170.666667-170.666666-170.666667 76.544-170.666666 170.666666 76.544 170.666667 170.666666 170.666667z"
                />
              </svg>
              {{ range $categories }}
                <a
                  class="mx-1 my-0.5 rounded-xl bg-gray-200 bg-opacity-30 px-1.5 py-0.5 text-center text-xs text-gray-900 hover:bg-opacity-80 hover:text-blue-700"
                  href="{{ .Permalink }}"
                  >{{ .LinkTitle }}</a
                >
              {{ end }}
            </div>
          {{ end }}

        </div>
      </div>

      {{/* toc */}}
      {{ if not $metaInfo.disableToc }}
        <div id="catalog" class="sticky z-20 hidden h-full w-[21%] pl-2 lg:inline" style="top: 176px;">
          <aside class="bg-slate-50 px-5 pb-5">
            <div class="bottom-3 mt-7 border-gray-400 px-2 py-3 text-left text-sm font-semibold uppercase">Catalog</div>
            <div class="mb-4 mt-0 border-b border-gray-400"></div>
            {{ .TableOfContents }}
          </aside>
        </div>
      {{ end }}
    </div>

    {{/* comments */}}
    {{ if .Site.Params.enableComments }}
      {{ .Scratch.Set "maxW" $maxW }}
      {{- partial "comments.html" . -}}
    {{ end }}
  </div>

  {{/* image zoom in content */}}
  {{- partial "img_zoom.html" . -}}

  {{ if .Site.Params.enableToTop }}
    {{- partial "to_top.html" . -}}
  {{ end }}

{{ end }}

{{ define "script" }}
  {{ if not .Site.Params.articleMeta.disableToc }}
    {{ $tocJS := resources.Get "/js/toc.js" }}
    {{ if hugo.IsProduction }}
      {{ $tocJS = $tocJS | minify | fingerprint }}
    {{ end }}
    <script src="{{ $tocJS.RelPermalink }}"></script>
  {{ end }}

  {{ if and .Site.Params.waline.serverURL .Site.Params.waline.alonePageview }}
    <script src="https://unpkg.com/@waline/client@v2/dist/pageview.js"></script>
    {{ $serverURL := .Site.Params.waline.serverURL }}
    {{ $walineInfo := dict "serverURL" $serverURL }}
    {{ $walinePageViewJS := resources.Get "/js/waline-pageview.js" | js.Build (dict "params" $walineInfo) }}
    {{ if hugo.IsProduction }}
      {{ $walinePageViewJS = $walinePageViewJS | minify | fingerprint }}
    {{ end }}
    <script src="{{ $walinePageViewJS.RelPermalink }}" defer></script>
  {{ end }}

  {{ $zoomJS := resources.Get "/js/zoom-img.js" }}
  {{ if hugo.IsProduction }}
    {{ $zoomJS = $zoomJS| minify | fingerprint }}
  {{ end }}
  <script src="{{ $zoomJS.RelPermalink }}" defer></script>
{{ end }}
